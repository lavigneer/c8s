# Implementation Plan: Local Kubernetes Development Tooling

**Branch**: `003-implement-tilt-or` | **Date**: 2025-10-22 | **Spec**: [spec.md](spec.md)
**Input**: Feature specification from `/specs/003-implement-tilt-or/spec.md`

## Summary

Integrate Tilt into the C8S project development workflow to provide automatic code change detection, component rebuilding, deployment, and unified logging. Tilt handles the complexity of local Kubernetes development out-of-the-box with a battle-tested tool, eliminating the need for custom implementation. We create a Tiltfile that defines C8S components (controller, API server, webhook) and build/deployment steps, plus documentation for developers. This reduces developer iteration time from hours to minutes and simplifies local deployment of the entire C8S stack.

## Technical Context

**Language/Version**: Go 1.25+
**Primary Dependencies**: Tilt (dev tool), k3d (local K8s cluster), kubectl, Docker
**Storage**: Local cluster (k3d), local filesystem for configuration
**Testing**: Integration tests validating Tiltfile configuration and build steps
**Target Platform**: Linux/macOS development machines
**Project Type**: Development environment configuration (Tiltfile + documentation)
**Performance Goals**: Code change detection and redeployment within 30 seconds (Tilt native); setup completion within 5 minutes
**Constraints**: Must run on machines with 4+ GB RAM, requires Docker daemon access, Tilt must be installed
**Scale/Scope**: Local development use case, manages 3 components (controller, api-server, webhook)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

**Principle I (Specification-First Development)**: ✅ PASS
- Feature specification complete with user stories, requirements, and success criteria
- Clarifications resolved (pipeline validation approach confirmed)

**Principle II (User Story-Driven Architecture)**: ✅ PASS
- 5 prioritized, independently testable user stories (P1, P2, P3)
- Each story delivers standalone value and can be implemented/tested independently
- P1 stories provide minimal viable product (dev setup + hot reload + pipeline testing)

**Principle III (Constitution Gates)**: ✅ PASS
- Architectural approach is simple: use battle-tested Tilt tool instead of custom implementation
- No custom complexity or premature abstraction
- Leverages proven patterns rather than building new infrastructure

**Principle IV (Test Independence)**: ✅ PASS
- Tests will be organized by user story, allowing independent validation
- Integration tests for multi-component scenarios
- Unit tests for individual components (validation, file watching, etc.)

**Principle V (Documentation as Artifact)**: ✅ PASS
- Design artifacts will include data-model, API contracts, and quickstart guide
- All artifacts version-controlled and kept synchronized

**Overall**: ✅ CONSTITUTION CHECK PASSED - No violations detected

## Project Structure

### Documentation (this feature)

```
specs/003-implement-tilt-or/
├── spec.md              # Feature specification
├── plan.md              # This file
├── research.md          # Phase 0: Technology and pattern research
├── data-model.md        # Phase 1: Entity definitions and state management
├── quickstart.md        # Phase 1: Setup and usage guide
├── contracts/           # Phase 1: API and configuration contracts
│   ├── dev-commands.md  # CLI command specifications
│   └── file-formats.md  # Configuration file formats
├── tasks.md             # Phase 2: Implementation tasks (generated by /speckit.tasks)
└── checklists/
    └── requirements.md  # Quality validation checklist
```

### Source Code (repository root)

The feature consists of Tilt configuration and documentation:

```
Tiltfile                           # NEW: Main Tilt configuration for C8S local development
tilt/                              # NEW: Directory for Tilt-related resources
├── Tiltfile                       # Main configuration (alternative location)
└── extensions/                    # Optional: Custom Tilt extensions if needed

deploy/                            # Existing Kubernetes manifests (referenced by Tiltfile)
├── crds.yaml                      # CRD definitions (watched for changes)
├── rbac.yaml                      # RBAC configuration
└── install.yaml                   # Component manifests

docs/
└── tilt-setup.md                  # NEW: Tilt-specific setup and usage documentation

Dockerfile                         # Existing: Used by Tilt builds
Makefile                           # Existing: Contains build targets used by Tilt
```

**Structure Decision**: The implementation uses a single Tiltfile at repository root (standard Tilt convention) to orchestrate the build and deployment of C8S components. No new code packages are created. Configuration is declarative YAML-like format (Tilt's Python-like DSL) rather than Go code.

## Complexity Tracking

No Constitution violations detected. Implementation follows established patterns.

---

## Key Differences from Custom Implementation

This plan shifts from building custom tooling to using Tilt, which provides:

- **Automatic file watching**: Tilt's built-in file watching eliminates custom fsnotify implementation
- **Smart rebuilding**: Tilt optimizes build caching and only rebuilds affected components
- **Unified UI**: Tilt's web dashboard replaces custom log aggregation implementation
- **Kubernetes integration**: Native K8s API integration already built-in
- **Community support**: Battle-tested tool with active community

Benefits:
- ✅ 80% less custom code to maintain
- ✅ Faster time-to-value (Tilt is production-ready)
- ✅ Better developer experience (Tilt is specifically designed for this)
- ✅ Future flexibility (Tilt features available immediately)

## Phase 1 Deliverables

- **Tiltfile**: Configuration for building and deploying all C8S components
- **data-model.md**: Document the structure and state managed by Tilt
- **tilt-setup.md**: Quick-start guide for developers using Tilt
- **contracts/tiltfile-spec.md**: Contract defining Tiltfile interface and customization points
